# Сбор данных о поступающих в ВУЗы России
Летняя учебная практика в 2018 г.

**Руководитель**: Паринов Андрей Андреевич.

## Технологии
- *Python 3*.
- Библиотеки *urllib*, *BeautifulSoup 4*, *threading*, *logging*, *json*, *ssl*.

## Отслеживаемые ВУЗы
### СПбГУ &mdash; `main-spbu.py`
Списки поступающих находятся на странице <https://cabinet.spbu.ru/Lists/1k_EntryLists/>, где у каждого поступающего есть ссылки на таблицы с конкурсами.

#### Работа скрипта по шагам
- Строится список поступающих.
- Вытаскиваются конкурсы для каждого поступающего (асинхронно многопоточно).
- Списки конкурсов объединяются в единый список.
- Вытаскиваются поступающие для каждого конкурса (асинхронно многопоточно): парсятся общие для конкурса свойства, далее происходит итерация по таблице.
- Списки поступающих объединяются в единый словарь.
- Словарь сохраняется в файл `data-spbu.json`.

Если какая-то веб-страница не отвечает, обращение к ней происходит несколько раз (максимальное количество попыток определено в файле исходников).

#### Собираемые данные

Следующие данные сохраняются и в структуру в Python, и в json файл:

Признак | Название | Тип
--- | --- | ---
ФИО абитуриента | `abitName` | Строка
Дата рождения | `birthday` | Строка в формате `дд.мм.гггг`
Направление подготовки / Специальность | `specialty` | Строка
Образовательная программа | `eduProg` | Строка
Основа обучения (*бюджет* или *коммерция*?) | `forMoney` | Коммерция &mdash; `True`, бюджет &mdash; `False`
Баллы ЕГЭ (*по предметам* и *сумма*) | `grades` | Словарь вида { `предмет1`: `балл1`, `предмет2`: `балл2`, `предмет3`: `балл3`, `"sum"`: `сумма баллов за предметы и за ИД` }, баллы десятичные (`null`, если н/д)
Индивидуальные достижения (*сумма*) | `extraBonus` | Десятичное (`null`, если н/д)
Аттестат (*подлинник* или *копия*?) | `original` | Подлинник &mdash; `True`, копия &mdash; `False`
Форма обучения (*очная* или *очно-заочная*?) | `onlyInWalls` | Очная &mdash; `True`, очно-заочная &mdash; `False`
Тип отбора (*общий конкурс* или *без вступительных испытаний* или *вне конкурса*?) | `contestType` | Строка: общий конкурс &mdash; `common`, без вступительных испытаний &mdash; `bvi`, вне конкурса &mdash; `vk`

Некоторых данных может не быть.

#### Пример выходного файла

```json
{
    "0": {
        "specialty": "47.03.03 Религиоведение",
        "eduProg": "СВ.5042.2018 Религиоведение",
        "onlyInWalls": true,
        "forMoney": false,
        "abitName": "Фамилия Имя Отчество",
        "birthday": "30.05.2000",
        "contestType": "common",
        "grades": {
            "sum": 282.0,
            "История": 91.0,
            "Обществознание": 88.0,
            "Русский язык": 100.0
        },
        "extraBonus": 3.0,
        "original": true,
        "source-page": "https://cabinet.spbu.ru/Lists/1k_EntryLists/list_282abfb0-3bbe-4c26-ba3f-d86356ddba05.html"
    },
    /* Здесь остальные строки файла*/
}
```

### РАНХиГС &mdash; `main-ranepa.py`
Списки направлений находятся на странице <https://lk.ranepa.ru/pk/list.php?FT=1&FL=0&FK=&FC=&FB=&FO=&F1=3dfc1680-5eff-4887-a318-288990d0e055>.

#### Собираемые данные

Следующие данные сохраняются и в структуру в Python, и в json файл:

Признак | Название | Тип
--- | --- | ---
ФИО абитуриента | `abitName` | Строка
Направление подготовки / Специальность | `specialty` | Строка
Образовательная программа | `eduProg` | Строка
Основа обучения (*бюджет* или *коммерция*?) | `forMoney` | Коммерция &mdash; `True`, бюджет &mdash; `False`
Баллы ЕГЭ (*по предметам* и *сумма*) | `grades` | Словарь вида { `предмет1`: `балл1`, `предмет2`: `балл2`, `предмет3`: `балл3`, `"sum"`: `сумма баллов за предметы и за ИД` }, баллы целые (`null`, если н/д)
Индивидуальные достижения (*сумма*) | `extraBonus` | Целое (`null`, если н/д)
Аттестат (*подлинник* или *копия*?) | `original` | Подлинник &mdash; `True`, копия &mdash; `False`
Форма обучения (*очная* или *очно-заочная* или *заочная*?) | `onlyInWalls` | Строка
Тип отбора (*по результатам ЕГЭ* или *без вступительных испытаний*?) | `contestType` | Строка

Некоторых данных может не быть.

## Известные проблемы
При использовании дебагера в консоль выдается много ошибок. Они возникают из-за использования парсера в многопоточном режиме (подробнее: <https://github.com/requests/requests/issues/4567>). На результат работы ошибки не влияют, при обычном консольном запуске эти ошибки не выдаются.
